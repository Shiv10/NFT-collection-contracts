// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.10;

import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/utils/Strings.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "hardhat/console.sol";
import {Base64} from "./libraries/Base64.sol";

contract MyEpicNFT is ERC721URIStorage {

    using Counters for Counters.Counter;
    Counters.Counter private _tokenIds;


    string svgPart1 = '<?xml version="1.0" standalone="no"?> <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"  "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"> <svg version="1.0" xmlns="http://www.w3.org/2000/svg"  width="300" height="400" viewBox="0 0 1325 1"  preserveAspectRatio="xMidYMid meet" style="background-color:';
    string svgPart2 = '">  <g transform="translate(0.000000,900.000000) scale(0.100000,-0.100000)" fill="';
    string svgPart3 = '" stroke="none"> <path d="M6928 17491 l-33 -29 68 -7 c45 -5 67 -12 67 -20 0 -8 -9 -17 -20 -20 -23 -7 -35 -44 -27 -84 3 -15 61 -169 127 -342 121 -311 127 -329 135 -381 4 -31 -7 -35 -42 -15 -13 7 -199 177 -414 377 -215 201 -403 371 -417 379 -26 14 -26 13 -12 -4 16 -20 575 -544 1731 -1623 410 -384 745 -698 744 -699 -1 -2 -222 -28 -491 -58 -800 -90 -3898 -435 -3906 -435 -13 0 -9 -44 5 -63 6 -10 28 -20 47 -23 19 -3 789 78 1710 181 921 102 1685 183 1697 180 67 -16 61 -3 494 -1120 226 -583 412 -1067 414 -1075 2 -8 4 -18 4 -22 1 -4 25 -11 54 -17 53 -11 877 -154 1389 -242 l287 -49 153 157 c84 86 632 643 1218 1236 610 618 1072 1094 1081 1113 9 19 26 45 39 59 13 14 22 26 19 28 -8 7 -391 172 -3177 1365 l-2822 1210 81 8 81 9 -71 28 c-99 38 -169 37 -213 -2z"/> <path d="M3760 14450 c0 -5 -12 -12 -27 -16 -16 -3 -40 -10 -55 -16 -30 -11 -587 -589 -619 -642 -35 -57 -17 -97 52 -116 33 -9 986 -60 1122 -60 63 0 71 2 96 29 15 16 38 31 50 33 23 3 23 3 4 28 -216 280 -606 770 -613 770 -6 0 -10 -4 -10 -10z"/> <path d="M6613 12859 c-7 -7 -13 -25 -13 -40 0 -18 123 -223 371 -620 204 -327 373 -599 376 -605 2 -7 -53 5 -124 27 -424 129 -882 187 -1265 161 -497 -33 -979 -177 -1460 -434 l-107 -57 -843 320 c-464 176 -940 357 -1058 401 l-214 80 -18 -22 c-34 -42 -18 -80 50 -113 26 -13 473 -185 995 -382 521 -198 947 -362 947 -365 0 -3 -22 -20 -48 -37 -45 -30 -55 -33 -128 -33 -95 0 -240 -22 -280 -43 -66 -34 -89 -84 -104 -233 -7 -60 -18 -118 -25 -130 -8 -12 -40 -31 -72 -44 -99 -39 -172 -81 -207 -120 l-34 -38 -923 -131 c-508 -73 -934 -135 -946 -138 -12 -3 -34 -16 -48 -29 -20 -18 -25 -33 -25 -68 0 -33 143 -489 510 -1622 281 -867 518 -1590 526 -1605 26 -51 77 -63 126 -31 15 10 150 125 299 257 l271 239 -78 39 -79 40 127 61 127 61 -489 424 c-270 234 -488 426 -486 428 2 3 192 36 423 74 230 38 433 71 451 74 l32 6 0 -178 c0 -369 69 -715 196 -982 43 -90 44 -97 27 -109 -10 -7 -53 -36 -97 -64 -102 -66 -239 -203 -309 -309 -223 -338 -244 -656 -68 -1042 71 -158 238 -319 442 -427 l67 -35 -1097 -333 c-603 -183 -1106 -335 -1118 -339 l-23 -5 26 68 c132 349 594 1618 590 1621 -9 9 -59 -22 -78 -47 -25 -35 -579 -1545 -585 -1596 -7 -53 20 -84 73 -84 29 0 2069 610 2179 652 17 6 41 19 54 28 23 16 28 16 95 -1 146 -38 303 -45 487 -22 l46 5 17 -73 c9 -40 32 -102 52 -137 19 -35 34 -65 32 -67 -2 -1 -316 -127 -698 -279 -382 -153 -696 -279 -698 -281 -2 -2 16 -9 40 -17 37 -13 43 -18 40 -40 -2 -14 4 -42 12 -62 8 -20 14 -37 13 -38 -1 -1 -130 -5 -287 -8 l-285 -6 310 -2 c171 -1 427 -7 570 -12 l260 -9 418 -116 c229 -63 423 -115 430 -115 10 0 10 38 0 192 -8 124 -9 194 -3 196 6 2 10 11 10 19 0 9 -6 13 -14 10 -17 -7 -22 26 -37 293 l-13 205 -34 54 c-52 81 -91 171 -106 242 l-13 64 -59 -5 c-138 -12 -358 -5 -439 14 -196 45 -361 138 -511 290 -81 81 -98 105 -142 198 -95 200 -128 345 -120 536 6 131 36 238 104 374 95 188 257 363 438 472 33 20 63 33 67 29 5 -6 197 -521 341 -912 23 -64 16 16 -31 331 -59 398 -79 542 -77 545 0 0 66 -12 146 -28 80 -17 214 -41 299 -54 85 -14 155 -26 156 -27 0 -2 7 -36 13 -77 38 -230 206 -452 425 -560 131 -65 211 -84 357 -84 132 0 216 17 328 69 223 102 381 291 442 529 26 100 28 270 6 369 -9 37 -16 72 -16 77 0 28 409 195 417 170 3 -8 120 -798 129 -867 l6 -52 -137 -4 c-130 -3 -138 -5 -157 -28 -13 -16 -18 -35 -16 -59 l3 -36 139 -1 c188 -2 283 10 375 47 56 23 99 32 160 37 71 4 89 9 108 28 13 13 23 34 23 47 0 63 -78 73 -236 31 -55 -15 -108 -27 -118 -28 -18 -1 -25 32 -87 439 -38 242 -68 449 -69 459 0 18 7 19 118 13 120 -6 261 -36 353 -75 l46 -20 6 -88 c21 -324 264 -614 587 -701 94 -26 310 -25 405 1 280 77 490 286 566 563 22 78 31 235 19 327 l-5 39 140 74 c77 41 180 97 228 125 49 27 90 49 91 47 2 -2 32 -194 67 -427 34 -232 66 -419 69 -415 4 5 17 190 29 413 12 223 24 440 28 483 l6 77 59 0 c79 0 197 -25 286 -61 242 -96 469 -349 562 -627 29 -85 34 -113 38 -233 8 -234 -38 -437 -128 -571 -134 -200 -318 -360 -496 -432 -114 -46 -352 -84 -396 -62 -16 7 -18 3 -18 -35 0 -95 -31 -327 -52 -389 -31 -94 -71 -180 -100 -215 -14 -16 -284 -417 -601 -891 -317 -473 -583 -866 -591 -874 -9 -7 -16 -18 -16 -24 0 -22 57 60 617 897 341 508 569 841 571 830 1 -10 14 -74 27 -143 39 -198 436 -2531 433 -2540 -3 -9 -60 -54 -1413 -1118 -555 -437 -1015 -799 -1022 -804 -8 -7 -375 207 -1210 705 l-1198 714 -12 -26 c-6 -14 -12 -22 -12 -16 -1 5 -111 -100 -246 -235 -154 -154 -248 -241 -254 -235 -5 6 -370 575 -812 1265 -764 1195 -864 1351 -882 1375 -11 14 -47 -32 -47 -60 0 -12 11 -42 24 -66 13 -24 388 -615 835 -1312 446 -698 811 -1271 811 -1275 0 -4 -339 -346 -752 -759 l-753 -753 805 0 c573 0 801 -3 790 -11 -11 -8 101 -9 387 -5 l402 6 20 -29 c30 -42 84 -64 143 -59 38 4 64 16 111 49 l62 44 3348 3 c1841 2 3347 7 3347 10 0 4 -365 403 -810 886 -446 484 -810 883 -810 886 0 4 629 283 1398 620 768 337 1401 616 1405 620 5 4 -12 20 -37 36 -26 16 -46 37 -46 46 0 10 -12 31 -27 47 -16 16 -713 430 -1549 919 -837 490 -1531 898 -1543 908 -32 28 -26 49 17 62 20 7 755 100 1632 207 877 108 1610 200 1627 206 37 12 73 52 73 81 0 18 -5 19 -47 14 -357 -44 -3641 -446 -3647 -446 -5 0 4 17 20 38 36 47 1115 1416 1244 1577 108 135 168 218 127 173 -30 -32 -119 -83 -402 -228 -121 -62 -285 -146 -364 -187 -79 -41 -140 -69 -135 -61 4 7 18 27 30 43 127 169 179 557 108 802 -77 265 -294 530 -527 643 -91 44 -213 76 -328 86 l-76 7 -6 386 c-7 403 -10 438 -62 674 -14 66 -39 201 -55 300 -45 281 -66 334 -174 457 -85 96 -117 162 -166 350 -59 223 -118 347 -258 544 -86 121 -278 315 -380 384 -122 83 -270 164 -419 231 l-128 57 -405 646 c-223 355 -412 656 -420 667 -12 18 -17 20 -27 10z m127 -1833 c383 -49 662 -126 817 -227 141 -92 226 -232 292 -484 55 -210 101 -338 181 -500 100 -205 172 -308 315 -449 133 -131 189 -208 278 -383 140 -274 225 -525 262 -771 15 -96 25 -175 23 -177 -2 -1 -32 -17 -68 -35 -36 -18 -136 -75 -223 -127 -87 -52 -161 -93 -164 -90 -3 3 -16 35 -28 71 -170 488 -758 688 -1188 406 -178 -117 -305 -307 -345 -515 -8 -44 -16 -81 -17 -83 -2 -2 -25 10 -52 26 -118 70 -272 112 -408 112 l-73 0 -22 145 c-12 79 -27 149 -34 154 -6 5 -22 10 -36 11 -72 6 -76 -9 -50 -181 12 -78 20 -142 18 -143 -1 -2 -34 -13 -73 -26 -92 -30 -205 -89 -284 -148 l-64 -49 -34 67 c-99 193 -292 345 -507 400 -109 28 -283 28 -392 0 -337 -86 -568 -365 -600 -722 -3 -43 -8 -78 -10 -78 -3 0 -104 20 -227 44 -122 24 -255 50 -295 56 -61 10 -73 15 -77 33 -7 32 -52 424 -70 617 -9 91 -19 253 -22 360 -5 183 -4 203 20 320 15 69 38 242 52 385 51 515 61 548 263 855 168 255 236 343 348 450 107 102 211 169 454 292 451 229 802 347 1170 394 143 18 696 12 870 -10z m3803 -4212 c3 -3 2 -16 -3 -29 -14 -36 -1068 -1368 -1103 -1393 -20 -15 -42 -22 -62 -20 -22 2 -399 210 -424 234 -2 2 8 36 22 76 29 81 43 157 53 294 l7 91 53 26 c29 14 95 33 146 42 206 36 359 112 512 256 89 84 97 89 411 251 176 91 327 167 335 171 21 8 45 8 53 1z"/> <path d="M7733 9149 c-78 -14 -256 -92 -558 -245 -388 -195 -664 -347 -694 -381 -18 -21 -22 -34 -18 -65 7 -50 20 -65 69 -79 31 -8 50 -7 90 7 27 9 298 140 601 291 542 270 553 275 602 270 55 -6 153 -42 318 -119 59 -27 123 -50 142 -51 104 -3 108 143 6 207 -73 46 -237 106 -401 146 -113 28 -109 27 -157 19z"/> <path d="M4407 8636 c-115 -48 -261 -148 -387 -264 -64 -59 -65 -60 -65 -112 0 -68 24 -90 100 -90 62 0 95 19 245 144 52 44 122 97 154 118 53 34 66 38 125 38 109 0 309 -37 907 -169 177 -39 338 -71 357 -71 45 0 67 28 67 87 0 61 -15 92 -52 107 -91 38 -1128 223 -1298 232 -85 4 -101 2 -153 -20z"/> <path d="M1278 12103 c-8 -10 -18 -24 -22 -30 -13 -23 -246 -1185 -246 -1225 0 -30 7 -46 29 -69 25 -25 37 -29 82 -29 83 0 1258 88 1323 99 54 10 96 32 96 53 0 14 -73 10 -761 -42 -365 -27 -673 -50 -684 -50 -20 0 -19 9 33 263 29 144 87 429 128 632 41 204 76 380 79 393 4 18 1 22 -18 22 -13 0 -31 -8 -39 -17z"/> <path d="M12875 11487 c-11 -6 -45 -14 -75 -18 -77 -9 -2550 -1094 -2593 -1138 -39 -38 -32 -73 21 -100 46 -23 2520 -592 2581 -593 35 -1 49 4 66 24 11 13 27 22 34 20 10 -3 11 119 6 649 -4 360 -10 770 -14 911 -6 253 -6 256 -26 245z"/> <path d="M7791 5910 c-87 -75 -278 -142 -497 -175 -54 -8 -268 -22 -474 -30 -475 -19 -738 -33 -819 -46 -88 -14 -169 -42 -274 -96 -90 -47 -250 -160 -251 -178 -2 -24 174 -149 289 -206 180 -89 277 -112 490 -113 178 0 274 12 460 59 50 12 91 22 91 21 1 0 -263 -226 -588 -501 -324 -275 -592 -504 -595 -509 -3 -5 10 -6 31 -2 48 9 149 -10 206 -39 54 -27 125 -101 147 -153 22 -52 20 -155 -5 -219 -11 -29 -19 -53 -18 -53 2 0 53 60 113 133 362 435 684 864 1007 1336 l146 214 123 93 c237 180 366 314 458 477 14 25 -1 20 -40 -13z m-53 -103 c-26 -39 -90 -107 -158 -168 -161 -146 -319 -268 -295 -229 5 8 35 56 67 105 l58 90 132 76 c140 81 192 129 67 61 -130 -70 -283 -110 -544 -142 -210 -26 -466 -68 -735 -121 -227 -45 -614 -126 -645 -137 -39 -12 68 -21 345 -28 501 -12 864 34 1113 140 20 9 37 14 37 12 0 -4 -278 -242 -331 -283 -8 -7 -60 -24 -114 -38 -324 -84 -619 -87 -838 -8 -130 46 -273 129 -371 215 l-39 34 83 61 c166 121 314 184 480 202 110 12 385 26 795 41 160 6 344 17 410 26 194 24 427 91 495 144 14 10 26 17 28 15 2 -2 -16 -32 -40 -68z m-405 -217 c-72 -62 -229 -141 -348 -174 -112 -32 -282 -61 -445 -77 -139 -13 -647 -16 -731 -4 l-54 8 105 23 c434 96 907 182 1175 214 94 12 208 29 255 39 47 11 89 19 93 20 5 1 -18 -22 -50 -49z"/> <path d="M1867 4199 c-10 -6 -34 -12 -52 -14 -19 -2 -59 -17 -89 -33 -52 -30 -1453 -889 -1509 -926 l-27 -18 0 51 c0 48 -1 51 -19 41 -42 -22 -89 -77 -101 -118 -19 -61 0 -115 57 -169 25 -24 50 -43 54 -43 5 0 9 22 9 49 l0 48 623 -465 c826 -618 831 -622 872 -622 19 0 41 7 49 16 9 8 20 13 25 10 13 -8 15 17 81 1124 33 547 61 1014 62 1038 3 43 -4 49 -35 31z"/> </g> </svg> ';

    constructor () payable ERC721("Fumigans", "FIG") {
        console.log("Running NFT contract.");
    }

    function mintNFT(string calldata background, string calldata foreground) public payable {

        require(msg.value >= 1*10*14, "Not enough eth paid to mint");

        string memory finalSvg = string(abi.encodePacked(svgPart1, background, svgPart2, foreground, svgPart3));

        uint256 newItemId = _tokenIds.current(); 
        string memory _name = string(abi.encodePacked("Fumigans #", Strings.toString(newItemId)));
        string memory json = Base64.encode(
            bytes(
                string(
                    abi.encodePacked(
                        '{"name": "',
                        _name,
                        '", "description": "An NFT of the Fumigans collection", "image": "data:image/svg+xml;base64,',
                        Base64.encode(bytes(finalSvg)),
                        '}'
                    )
                )
            )
        );
        // console.log('\nToken URI\n-------------------------------------------------------------------');
        string memory finalTokenUri = string( abi.encodePacked("data:application/json;base64,", json));
        // console.log(finalTokenUri);
        // console.log('\nToken URI\n-------------------------------------------------------------------');
        _safeMint(msg.sender, newItemId);
        _setTokenURI(newItemId, finalTokenUri);
        _tokenIds.increment();
        console.log("An NFT w/ ID %s has been minted to %s", newItemId, msg.sender);
    }
}

